<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>Bolinha Saltitante ‚Äì Desenho Infantil</title>
  <style>
    :root{
      --sky1:#fdf5ff;
      --sky2:#c7e7ff;
      --grass:#b8f7a0;
      --line:#2b2240;
      --accent:#ff9ecb;
      --accent2:#ffd166;
      --accent3:#9ad5ff;
      --accent4:#f4b942;
    }
    html,body{margin:0;height:100%;background:var(--sky2);font-family: "Comic Sans MS", "Comic Neue", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;color:var(--line);}
    #wrap{display:flex;flex-direction:column;align-items:center;gap:8px;padding:10px;}
    canvas{background:linear-gradient(180deg,var(--sky1) 0%, var(--sky2) 55%, var(--grass) 55%);border:4px dashed var(--line);border-radius:16px;touch-action:manipulation;}
    .hud{display:flex;gap:14px;font-weight:800;font-size:16px;align-items:center;user-select:none;-webkit-user-select:none;}
    .hud .chip{padding:6px 10px;border:3px solid var(--line);border-radius:999px;background:white;box-shadow:2px 2px 0 var(--line);}
    .bar{display:flex;gap:8px}
    button{border:3px solid var(--line);background:var(--accent2);padding:8px 12px;border-radius:12px;font-weight:900;box-shadow:3px 3px 0 var(--line);cursor:pointer}
    button:disabled{opacity:.6;cursor:default}
    .tip{font-size:14px}
  </style>
</head>
<body>
  <div id="wrap">
    <div class="hud">
      <div class="chip">üèÜ Pontos: <span id="score">0</span></div>
      <div class="chip">‚ö° Velocidade: <span id="spd">1.0x</span></div>
      <div class="chip">üåü Melhor: <span id="best">0</span></div>
    </div>
    <canvas id="game" width="900" height="520" aria-label="Bolinha Saltitante"></canvas>
    <div class="bar">
      <button id="start">‚ñ∂Ô∏è Come√ßar</button>
      <button id="pause" disabled>‚è∏Ô∏è Pausar</button>
      <button id="restart" disabled>üîÑ Reiniciar</button>
    </div>
    <div class="tip">PC: Espa√ßo/‚Üë para pular ‚Ä¢ Celular: toque na tela ‚Ä¢ Segure para pulo mais alto</div>
  </div>

<script>
(() => {
  const cvs = document.getElementById('game');
  const ctx = cvs.getContext('2d');
  const scoreEl = document.getElementById('score');
  const spdEl = document.getElementById('spd');
  const bestEl = document.getElementById('best');
  const btnStart = document.getElementById('start');
  const btnPause = document.getElementById('pause');
  const btnRestart = document.getElementById('restart');

  const W = cvs.width, H = cvs.height;
  const groundY = Math.floor(H * 0.55) + 50;
  let baseSpeed = 5.3;
  let speed = baseSpeed;
  let t = 0;
  let spawnTimer = 0;
  let spawnEvery = 95;

  let running = false, paused = false;
  let score = 0, best = +(localStorage.getItem('bolinha_best')||0);

  const ball = {
    x: 150, y: groundY - 34, r: 34, vy: 0, g: 0.95, jumpForce: 17,
    jumping: false, stretchX: 1, stretchY: 1,
    jump(power=1){
      if (this.onGround()) {
        this.vy = -this.jumpForce * Math.min(1.35, Math.max(0.7, power));
        this.jumping = true; this.stretchX = 1.25; this.stretchY = 0.8;
      }
    },
    onGround(){ return (this.y + this.r) >= groundY - 0.001;},
    update(){
      this.vy += this.g; this.y += this.vy;
      if (this.y + this.r >= groundY){
        this.y = groundY - this.r; this.vy = 0;
        if (this.jumping){ this.stretchX = 1.35; this.stretchY = 0.75; }
        this.jumping = false;
      }
      this.stretchX += (1 - this.stretchX) * 0.15;
      this.stretchY += (1 - this.stretchY) * 0.15;
    },
    draw(){
      ctx.save();
      const wobble = Math.sin(t*0.15)*0.04;
      ctx.translate(this.x, this.y);
      ctx.scale(this.stretchX, this.stretchY);
      doodleCircle(0,0,this.r, getColor('--accent'), 5 + wobble);
      ctx.save();
      ctx.translate(0, -6);
      doodleCircle(-10, 0, 4, getColor('--line'), 2);
      doodleCircle( 10, 0, 4, getColor('--line'), 2);
      ctx.beginPath(); ctx.lineWidth = 3; ctx.strokeStyle = getColor('--line');
      ctx.arc(0, 8, 12, 0.15*Math.PI, 0.85*Math.PI); ctx.stroke();
      ctx.restore();
      ctx.restore();
    }
  };

  const obs = [];
  const TYPES = ['pedrinha','toco','caixote','buraco'];

  function rand(a,b){ return Math.floor(Math.random()*(b-a+1))+a; }
  function getColor(varname){ return getComputedStyle(document.documentElement).getPropertyValue(varname).trim(); }

  function spawn(){
    const type = TYPES[rand(0, TYPES.length-1)];
    if (type === 'buraco'){
      const w = rand(90, 160);
      obs.push({type, x:  W+40, y: groundY, w, h: 40, scored:false});
    } else if (type === 'pedrinha'){
      const s = rand(28, 48);
      obs.push({type, x:  W+40, y: groundY - s, w: s, h: s, scored:false});
    } else if (type === 'toco'){
      const w = rand(26, 40), h = rand(44, 70);
      obs.push({type, x:  W+40, y: groundY - h, w, h, scored:false});
    } else {
      const w = rand(38, 60), h = rand(30, 44);
      obs.push({type, x:  W+40, y: groundY - h, w, h, scored:false});
    }
  }

  function doodleCircle(x,y,r, fill, strokeW=3){
    ctx.beginPath(); ctx.fillStyle = fill;
    ctx.arc(x+shake(1.2), y+shake(1.2), r+shake(0.8), 0, Math.PI*2);
    ctx.fill(); ctx.lineWidth = strokeW; ctx.strokeStyle = getColor('--line'); ctx.stroke();
  }
  function doodleRect(x,y,w,h, fill){
    ctx.beginPath(); ctx.fillStyle = fill;
    ctx.rect(x+shake(1.5), y+shake(1.5), w+shake(1.5), h+shake(1.5));
    ctx.fill(); ctx.lineWidth = 3; ctx.strokeStyle = getColor('--line'); ctx.strokeRect(x, y, w, h);
  }
  function shake(s){ return (Math.random()-0.5)*s; }

  function drawSun(){
    const cx = 90, cy = 90;
    doodleCircle(cx, cy, 34, getColor('--accent2'), 4);
    ctx.beginPath(); ctx.fillStyle = getColor('--line');
    ctx.arc(cx-8, cy-4, 3, 0, Math.PI*2); ctx.arc(cx+8, cy-4, 3, 0, Math.PI*2); ctx.fill();
    ctx.beginPath(); ctx.lineWidth=2.5; ctx.strokeStyle=getColor('--line');
    ctx.arc(cx, cy+4, 10, 0.15*Math.PI, 0.85*Math.PI); ctx.stroke();
    for (let a=0;a<12;a++){
      const ang = (a/12)*Math.PI*2 + (t*0.02);
      const r1 = 44, r2 = 60;
      ctx.beginPath();
      ctx.moveTo(cx + Math.cos(ang)*r1, cy + Math.sin(ang)*r1);
      ctx.lineTo(cx + Math.cos(ang)*r2, cy + Math.sin(ang)*r2);
      ctx.lineWidth = 3; ctx.strokeStyle = getColor('--line'); ctx.stroke();
    }
  }
  function drawCloud(x,y,s){
    ctx.fillStyle = 'white';
    doodleCircle(x, y, s, 'white', 3);
    doodleCircle(x+s*0.8, y+6, s*0.9, 'white', 3);
    doodleCircle(x-s*0.8, y+10, s*0.7, 'white', 3);
  }
  function drawBird(x,y){
    ctx.beginPath(); ctx.strokeStyle = getColor('--line'); ctx.lineWidth=3;
    ctx.moveTo(x-8,y);
    ctx.quadraticCurveTo(x-2,y-6,x,y);
    ctx.quadraticCurveTo(x+2,y-6,x+8,y);
    ctx.stroke();
  }

  function drawGroundDecor(){
    ctx.strokeStyle = getColor('--line'); ctx.lineWidth=2;
    for (let x = 0; x<W; x+=20){
      const gx = (x - (t*speed*0.7)%20);
      ctx.beginPath(); ctx.moveTo(gx, groundY);
      ctx.lineTo(gx+shake(2), groundY-10+shake(2)); ctx.stroke();
    }
    const fenceY = groundY-26;
    for (let x = 0; x<W+100; x+=60){
      const fx = (x - (t*speed*1.0)%60);
      doodleRect(fx, fenceY, 10, 26, getColor('--accent3'));
      ctx.beginPath(); ctx.lineWidth=3; ctx.strokeStyle=getColor('--line');
      ctx.moveTo(fx+10, fenceY+6);  ctx.lineTo(fx+46, fenceY+6);
      ctx.moveTo(fx+10, fenceY+18); ctx.lineTo(fx+46, fenceY+18); ctx.stroke();
    }
  }

  function circleRectCollision(cx,cy,cr, rx,ry,rw,rh){
    const tx = Math.max(rx, Math.min(cx, rx+rw));
    const ty = Math.max(ry, Math.min(cy, ry+rh));
    const dx = cx - tx, dy = cy - ty;
    return (dx*dx+dy*dy) <= (cr*cr);
  }

  function update(){
    if (!running || paused) return;
    t++;
    speed += 0.0009;                            // acelera com o tempo
    const boost = 1 + (Math.floor(score/4) * 0.06);
    const gameSpeed = speed * boost;
    spdEl.textContent = (gameSpeed/baseSpeed).toFixed(1) + "x";

    ball.update();

    spawnTimer++;
    if (spawnTimer >= spawnEvery){
      spawn(); spawnTimer = 0;
      spawnEvery = Math.max(52, spawnEvery - 1); // spawns mais frequentes
    }

    for (let i = obs.length-1; i>=0; i--){
      const o = obs[i];
      o.x -= gameSpeed;

      if (o.type === 'buraco'){
        if (!o.scored && (ball.x - ball.r) > (o.x + o.w)){ score++; o.scored = true; }
        const over = (ball.x + ball.r > o.x) && (ball.x - ball.r < o.x + o.w);
        if (over && ball.y + ball.r >= groundY){ end(); return; }
      } else {
        if (!o.scored && (o.x + o.w) < (ball.x - ball.r)){ score++; o.scored = true; }
        if (circleRectCollision(ball.x, ball.y, ball.r, o.x, o.y, o.w, o.h)){ end(); return; }
      }

      if (o.x + (o.w||0) < -60) obs.splice(i,1);
    }

    scoreEl.textContent = score;
  }

  function draw(){
    ctx.clearRect(0,0,W,H);
    drawSun();
    drawCloud(220 - (t*0.25)%(W+260), 90, 36);
    drawCloud(520 - (t*0.20)%(W+260), 60, 28);
    drawCloud(820 - (t*0.22)%(W+260), 120, 34);
    drawBird(680 - (t*0.9)%(W+180), 110);
    drawBird(420 - (t*0.7)%(W+180), 140);
    drawGroundDecor();
    for (const o of obs){
      if (o.type === 'buraco'){
        ctx.fillStyle = getColor('--line');
        ctx.fillRect(o.x-2, groundY-6, 4, 6);
        ctx.fillRect(o.x+o.w-2, groundY-6, 4, 6);
        const grad = ctx.createLinearGradient(0, groundY, 0, groundY+40);
        grad.addColorStop(0, 'rgba(0,0,0,0.5)'); grad.addColorStop(1, 'rgba(0,0,0,0)');
        ctx.fillStyle = grad; ctx.fillRect(o.x, groundY, o.w, 42);
      } else if (o.type === 'pedrinha'){
        doodleRect(o.x, o.y, o.w, o.h, '#e6e6e6');
      } else if (o.type === 'toco'){
        doodleRect(o.x, o.y, o.w, o.h, '#d8a676');
        ctx.strokeStyle = getColor('--line'); ctx.lineWidth=2;
        for (let yy=o.y+4; yy<o.y+o.h; yy+=10){
          ctx.beginPath(); ctx.moveTo(o.x+3, yy); ctx.lineTo(o.x+o.w-3, yy); ctx.stroke();
        }
      } else {
        doodleRect(o.x, o.y, o.w, o.h, getColor('--accent4'));
      }
    }
    ball.draw();
    ctx.lineWidth = 6; ctx.strokeStyle = getColor('--line'); ctx.strokeRect(3,3,W-6,H-6);
  }

  function loop(){ update(); draw(); requestAnimationFrame(loop); }

  function start(){
    if (running) return;
    running = true; paused = false; btnPause.disabled = false; btnRestart.disabled = false;
    ball.jump(0.9);
  }
  function togglePause(){ if (!running) return; paused = !paused; btnPause.textContent = paused ? '‚ñ∂Ô∏è Continuar' : '‚è∏Ô∏è Pausar'; }
  function restart(){
    obs.length = 0; score = 0; spawnEvery = 95; speed = baseSpeed; t = 0; spawnTimer = 0;
    ball.x = 150; ball.y = groundY - ball.r; ball.vy = 0; ball.jumping=false; ball.stretchX=1; ball.stretchY=1;
    running = true; paused=false; btnPause.disabled=false;
  }
  function end(){
    running = false; paused = false; btnPause.disabled = true;
    best = Math.max(best, score); localStorage.setItem('bolinha_best', String(best)); bestEl.textContent = best;
    setTimeout(() => alert(`Fim de jogo!\n\nPontos: ${score}\nMelhor: ${best}\n\nToque em Reiniciar para jogar de novo.`), 30);
  }

  // Controles (toque/teclado com pulo carregado)
  let holding = false, holdStart = 0;
  function doJump(){
    const heldMs = holding ? (performance.now() - holdStart) : 0;
    const power = 0.8 + Math.min(0.6, heldMs/600); // 0.8 a 1.4
    ball.jump(power);
  }
  btnStart.addEventListener('click', () => { start(); doJump(); });
  btnPause.addEventListener('click', togglePause);
  btnRestart.addEventListener('click', restart);

  cvs.addEventListener('pointerdown', () => { if (!running){ start(); } holding = true; holdStart = performance.now(); });
  cvs.addEventListener('pointerup', () => { if (paused) return; holding=false; doJump(); });
  cvs.addEventListener('pointercancel', () => { holding=false; });

  window.addEventListener('keydown', (e)=>{
    if (e.code === 'Space' || e.code === 'ArrowUp'){ if (!running){ start(); } holding = true; holdStart = performance.now(); e.preventDefault(); }
    else if (e.code === 'KeyP'){ togglePause(); }
    else if (e.code === 'KeyR'){ restart(); }
  });
  window.addEventListener('keyup', (e)=>{ if (e.code === 'Space' || e.code === 'ArrowUp'){ holding=false; doJump(); e.preventDefault(); } });

  bestEl.textContent = best;
  loop();
})();
</script>
</body>
</html>
